<!DOCTYPE html>
<!-- saved from url=(0047)http://www.devforrest.com/examples/cvt/cvt.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">

<title>Voronoi Treemap</title>

<script language="javascript" type="text/javascript" src="jquery-1.11.0.min.js"></script>
<!-- <script language="javascript" type="text/javascript" src="d3.v2.js"></script> -->
<script language="javascript" type="text/javascript" src="d3-master/d3.js"></script>
<script language="javascript" type="text/javascript" src="ConvexHull.js"></script>
<script language="javascript" type="text/javascript" src="PowerDiagram.js"></script>
<script language="javascript" type="text/javascript" src="VoronoiTreemap.js"></script>
<script language="javascript" type="text/javascript" src="VoronoiTreemapD3.js"></script>

<!-- test input local filesystem -->
<script language="javascript" type="text/javascript" src="test.js"></script>
<script language="javascript" type="text/javascript" src="flare.js"></script>
<script language="javascript" type="text/javascript" src="simple_two.js"></script>
<script language="javascript" type="text/javascript" src="simple_three.js"></script>
<script language="javascript" type="text/javascript" src="simple_four.js"></script>
<script language="javascript" type="text/javascript" src="simple_eight.js"></script>
<script language="javascript" type="text/javascript" src="example.js"></script>
<script language="javascript" type="text/javascript" src="simple_two_mod.js"></script>
<script language="javascript" type="text/javascript" src="random_10_3_000.js"></script>
<script language="javascript" type="text/javascript" src="random_10_3_010.js"></script>
<script language="javascript" type="text/javascript" src="random_6_4_000.js"></script>
<script language="javascript" type="text/javascript" src="random_4_4_000.js"></script>
<script language="javascript" type="text/javascript" src="random_5_4_000.js"></script>
<script language="javascript" type="text/javascript" src="random_10_4_000.js"></script>
<script language="javascript" type="text/javascript" src="random_10_2_000.js"></script>
<script language="javascript" type="text/javascript" src="random_10_5_000.js"></script>
<script language="javascript" type="text/javascript" src="random_10_3_025.js"></script>



</head>
 
<body>

<h2>Voronoi Treemap</h2>

<!--
<div id="div1">This is div1</div><br><br>
-->

<script language="javascript">

//var dataset = flare_json;
//var dataset = simple_two_json;
//var dataset = simple_three_json;
//var dataset = simple_four_json;
//var dataset = simple_eight_json;
//var dataset = example_json;
//var dataset = flare_json;
var dataset = test_json;
//var dataset = simple_two_mod_json; // use "number" instead of "size"
//var dataset = random_10_3_010_json;

// has name for color
//var dataset = random_10_3_000_json;
//var dataset = random_10_3_025_json;


function make_regular_polygon(width, height, border, sides) {
	var center = [width*0.5, height*0.5],
		width_radius = (width - 2*border) * 0.5,
		height_radius = (height - 2*border) * 0.5,
		radius = Math.min( width_radius, height_radius ),
		angle_radians = 2*Math.PI / sides,
		initial_angle = sides%2==0 ? -Math.PI/2 -angle_radians*0.5 : -Math.PI/2, // subtract angles
		result = [],
		somevariable = 0;
	
	// special case few sides
	if (sides == 3) {
		center[1] += height_radius / 3.0; // can always do this (I think?)
	
		radius_for_width = width_radius * 2 / Math.sqrt(3);
		radius_for_height = height_radius * 4.0 / 3.0;
		radius = Math.min(radius_for_width, radius_for_height);
	}
	else if (sides == 4) {
		radius *= Math.sqrt(2);
	}
	
	for (var i = 0; i < sides; i++) {
		result.push([center[0] + radius * Math.cos(initial_angle - i * angle_radians), center[1] + radius * Math.sin(initial_angle - i * angle_radians)]);
	}

	return result;
}

// here we set up the svg
var width = 1000;
var height = 800;
var border = 10;
var svg_container = d3.select("body").append("svg").attr("width",width).attr("height",height);

///////// bounding polygon
// here's the whole svg as a poly...for whatever reason
var width_less_border = width - 2*border;
var height_less_border = height - 2*border;
var entire_svg_polygon = [[border,border],
	[border,height_less_border],
	[width_less_border,height_less_border],
	[width_less_border,border]];

//var root_polygon = make_regular_polygon(width, height, border, 100);
var root_polygon = entire_svg_polygon


function make_d3_poly(d) {
	return "M" + d.join("L") + "Z";
}


////////// old refresh function (includes sites)
var refresh = function(polygon_list, sites) {
	var polylines = svg_container.append("g").selectAll("path").data(polygon_list, make_d3_poly);
	polylines.enter().append("path")
			.attr("d", make_d3_poly)
			.attr("stroke-width", "5px")
			.attr("stroke", "black")
			.attr("fill", "cyan");
	polylines.exit().remove();
	
			
	var center_circles = svg_container.append("g").selectAll(".center.circle").data(sites);
	center_circles.enter().append("circle")
		.attr("class", "center circle")
		.attr("cx", function(d) {return (d.x);})
		.attr("cy", function(d) {return (d.y);})
		.attr("r", function(d) {return 5;})
		//.attr("r", function(d) {return (Math.sqrt(d.weight));})
		//.attr("r", function(d) {return (Math.max(Math.sqrt(d.weight), 2));})
		.attr("stroke", "black")
		.attr("fill", "black");
		
	var radius_circles = svg_container.append("g").selectAll(".radius.circle").data(sites);
	radius_circles.enter().append("circle")
		.attr("class", "radius circle")
		.attr("cx", function(d) {return (d.x);})
		.attr("cy", function(d) {return (d.y);})
		//.attr("r", function(d) {return 5;})
		.attr("r", function(d) {return (Math.sqrt(d.weight));})
		//.attr("r", function(d) {return (Math.max(Math.sqrt(d.weight), 2));})
		.attr("stroke", "red")
		.attr("fill", "none");
}



////////// Check the variables here
/*
var test = function(){
    
    VoronoiTreemap.normalizeSites(sites);
    
    VoronoiTreemap.sites = sites;
    VoronoiTreemap.setClipPolygon(svg_poly);
    VoronoiTreemap.useNegativeWeights = true;
    VoronoiTreemap.cancelOnAreaErrorThreshold =  true;

    var polygons = VoronoiTreemap.doIterate(100);

    refresh(polygons, sites)
}

d3.select("body").append("input")
	.attr("type", "button")
	//.attr("name", "iterate_button")
	.attr("id", "test_button")
	.attr("value", "Test!");
	
d3.select("#test_button").on("click", function() {test();});
*/

/*
var iterate = function() {
    polygons = VoronoiTreemap.iterate();
    
    refresh(polygons, sites);
}

d3.select("body").append("input")
	.attr("type", "button")
	//.attr("name", "iterate_button")
	.attr("id", "iterate_button")
	.attr("value", "Iterate!");
	
d3.select("#iterate_button").on("click", function() {iterate();});

var recursive = function() {
	var polygons_and_sites = VoronoiTreemap.computeVoronoiTreemapRecursive(svg_poly, dataset, 2);
	refresh(polygons_and_sites[0], polygons_and_sites[1]);
	console.log("recursive result:");
	console.log(polygons_and_sites);
}

d3.select("body").append("input")
	.attr("type", "button")
	//.attr("name", "iterate_button")
	.attr("id", "recursive_button")
	.attr("value", "Recursive Test");
	
d3.select("#recursive_button").on("click", function() {recursive();});
*/

// flare treemap color


var paint = function(nodes){
	// background color
	//var background_color = "lightgray";
	var background_color = "none";
	svg_container.append("g").append("rect")
		.attr("x", 0)
		.attr("y", 0)
		.attr("width", width)
		.attr("height", height)
		.attr("fill", background_color);

	// strokes by depth
	var stroke_min = 2,
		stroke_max = 10,
		stroke_levels = 3,// could determine from max depth...
		stroke_delta = (stroke_max - stroke_min) * 1.0 / stroke_levels; 

	// constant color
	//var color_func = "cyan";
	// brighter by depth
	//var color_func = function(d) { return d3.hsl("cyan").brighter( (d.depth-1) / 1.1) };
	// d3 treemap style (requires name)
	var color_d3 = d3.scale.category20c();
	var color_func = function(d) { return d.children ? color_d3(d.name) : "none"; };

    var data = [];
    for (var i = 0; i < nodes.length; i++){
        var node = nodes[i];
        if (node.polygon != null){
            data.push(node);
            //console.log(node);
        }
    }
    var polylines = svg_container.append("g").selectAll("path").data(data);
	polylines.enter().append("path")
	        .attr("d", function(d) {return make_d3_poly(d.polygon);})
	        //.attr("stroke-width", "5px")
			.attr("stroke-width", function(d) { return Math.max(stroke_max - stroke_delta*d.depth, stroke_min) + "px";})
	        .attr("stroke", "black")
	        .attr("fill", color_func);
    polylines.exit().remove();

}


<!-- D3 testing -->
	// paraphrasing treemap example http://bl.ocks.org/mbostock/4063582
	// also looking at http://bl.ocks.org/mbostock/4063423 for svg example
	/*
	var margin = {top: 40, right: 10, bottom: 10, left: 10},
		width = 960 - margin.left - margin.right,
		height = 500 - margin.top - margin.bottom;
		*/

var vt = d3.layout.voronoitreemap()
	.root_polygon(root_polygon)
	.value(function(d) {return d.size; })
	.iterations(100);

var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height);

var newnodes = vt(dataset);
paint(newnodes);


</script>


</body></html>
